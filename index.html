<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><title>Dragon's World</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0d0a1a;color:#fff;font-family:'Segoe UI',Arial,sans-serif;overflow:hidden}
#sel{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:20px}
#sel h1{font-size:3em;background:linear-gradient(90deg,#ff4400,#ffcc00,#00bbaa,#8844cc);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:6px}
#sel p{color:#aaa;margin-bottom:28px;text-align:center;font-size:.95em}
#grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;max-width:740px}
.card{border:2px solid;border-radius:14px;padding:20px 16px;text-align:center;cursor:pointer;transition:transform .15s,box-shadow .15s}
.card:hover{transform:translateY(-5px) scale(1.04);box-shadow:0 14px 36px rgba(0,0,0,.6)}
.card .em{font-size:2.8em}.card h3{margin:8px 0 4px;font-size:1.2em}
.card .el{font-size:.78em;font-weight:bold;letter-spacing:1px;text-transform:uppercase;opacity:.75;margin-bottom:6px}
.card .ab{font-size:.76em;color:#ddd;min-height:32px;margin-bottom:14px;line-height:1.4}
.card button{padding:7px 20px;border:none;border-radius:16px;cursor:pointer;font-weight:bold;color:#fff;font-size:.88em}
#game{display:none;position:relative}canvas{display:block}
#hud{position:fixed;top:10px;left:10px;background:rgba(0,0,0,.78);padding:10px 16px;border-radius:10px;font-size:14px;line-height:1.8;pointer-events:none;z-index:5}
#cdbar{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.78);padding:8px 24px;border-radius:20px;font-size:13px;pointer-events:none;z-index:5;white-space:nowrap}
#ov{position:fixed;inset:0;background:rgba(0,0,0,.88);display:none;align-items:center;justify-content:center;flex-direction:column;gap:20px;z-index:20}
#ov h2{font-size:3em;color:#ffd700}#ov p{font-size:1.1em;color:#ccc;text-align:center}
#ov button{padding:14px 40px;font-size:1.05em;background:#ffd700;border:none;border-radius:10px;cursor:pointer;font-weight:bold;color:#111}
@media(max-width:600px){#grid{grid-template-columns:repeat(2,1fr)}}
</style>
</head><body>
<div id="sel">
  <h1>üêâ Dragon's World</h1>
  <p>Choose your dragon. Collect all 4 zone eggs, then find the Golden Egg to win!<br>Move: WASD / Arrow Keys &nbsp;¬∑&nbsp; Ability: SPACE (10s cooldown)</p>
  <div id="grid"></div>
</div>
<div id="game"><canvas id="c"></canvas><div id="hud"></div><div id="cdbar"></div></div>
<div id="ov"><h2 id="oT"></h2><p id="oM"></p><button onclick="location.reload()">Play Again</button></div>

<script>
const DR=[
  {n:'Emberclaw', el:'Fire',   c:'#ff4400',bg:'#220800',em:'üî•',ab:'Fire blast that destroys obstacles'},
  {n:'Frostfang', el:'Ice',    c:'#4499ff',bg:'#001020',em:'‚ùÑÔ∏è',ab:'Ice wall behind you blocks enemies 3s'},
  {n:'Tidesong',  el:'Ocean',  c:'#00bbaa',bg:'#001a18',em:'üåä',ab:'2√ó speed boost for 3 seconds'},
  {n:'Verdenwing',el:'Forest', c:'#44bb44',bg:'#001200',em:'üåø',ab:'Invisible to enemies for 4 seconds'},
  {n:'Stormtalon',el:'Sky',    c:'#ffcc00',bg:'#181800',em:'‚ö°',ab:'Instant forward dash 230px'},
  {n:'Shadowmend',el:'Dark',   c:'#aa44cc',bg:'#110020',em:'üåë',ab:'Freeze all enemies for 5 seconds'},
];
// Zone definitions: each 1000x1000 quadrant
const ZN=[
  {n:'Volcanic Wastes', x:0,    y:0,    bg:'#1a0300',ac:'#ff4400',ec:'#ff3300',ow:54,oh:26,ename:'Magmawyrm'},
  {n:'Glacial Peaks',   x:1000, y:0,    bg:'#000d1e',ac:'#88ccff',ec:'#66aaee',ow:14,oh:74,ename:'Frostwyrm'},
  {n:'Sunken Reef',     x:0,    y:1000, bg:'#001212',ac:'#00bbaa',ec:'#00cc99',ow:30,oh:30,ename:'Tidewyrm'},
  {n:'Ancient Canopy',  x:1000, y:1000, bg:'#001300',ac:'#44aa44',ec:'#339933',ow:22,oh:54,ename:'Thornwyrm'},
];
const OBC=['#bb2200','#77aacc','#006655','#1e3e1e'];
const ESP=[210,78,145,125], ESZ=[20,46,20,20];

// Build select cards
const gEl=document.getElementById('grid');
DR.forEach((d,i)=>{
  const el=document.createElement('div');
  el.className='card';el.style.borderColor=d.c;el.style.background=d.bg;
  el.innerHTML=`<div class="em">${d.em}</div><h3 style="color:${d.c}">${d.n}</h3>`+
    `<div class="el" style="color:${d.c}">${d.el}</div><div class="ab">${d.ab}</div>`+
    `<button style="background:${d.c}" onclick="sg(${i})">‚ñ∂ Play</button>`;
  gEl.appendChild(el);
});

const cv=document.getElementById('c'), ctx=cv.getContext('2d');
const MAP=2000;
let P,ENS,OBS,EGS,GE,PTS,IW,PJ,gt,lts,st,di,dead,won,keys={},fx=1,fy=0;

// Utility
const hyp=(ax,ay,bx,by)=>Math.hypot(ax-bx,ay-by);
const hits=(a,b)=>a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y;
const rnd=(lo,hi)=>lo+Math.random()*(hi-lo);
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

function sg(idx){
  di=idx;
  document.getElementById('sel').style.display='none';
  document.getElementById('game').style.display='block';
  cv.width=innerWidth; cv.height=innerHeight;
  reset(); requestAnimationFrame(tick);
}

function reset(){
  dead=won=false; gt=0; st=0; lts=null;
  P={x:488,y:488,w:28,h:28,cd:0,spT:0,ivT:0};
  ENS=[]; OBS=[]; EGS=[]; IW=[]; PJ=[]; PTS=[]; GE=null;
  ZN.forEach((z,zi)=>{
    // Obstacles ‚Äî avoid player start area
    for(let i=0;i<12;i++){
      let ox,oy;
      do{ ox=rnd(z.x+40,z.x+960); oy=rnd(z.y+40,z.y+960); }
      while(hyp(ox,oy,502,502)<260);
      OBS.push({x:ox,y:oy,w:z.ow,h:z.oh,c:OBC[zi]});
    }
    // Zone egg
    EGS.push({x:rnd(z.x+200,z.x+800),y:rnd(z.y+200,z.y+800),r:12,done:false,t:0});
    // Initial enemies (2 per zone)
    se(zi); se(zi);
  });
}

function se(zi){
  const z=ZN[zi], sm=1+st*.2;
  ENS.push({
    x:rnd(z.x+80,z.x+920), y:rnd(z.y+80,z.y+920),
    w:ESZ[zi]*sm, h:ESZ[zi]*sm, spd:ESP[zi]*sm,
    c:z.ec, zi, ft:0, wt:rnd(0,6.28), tcd:rnd(0,2)
  });
}

// Move rect obj by dx,dy, colliding with bl array (tile-sliding)
function mv(o,dx,dy,bl){
  bl=bl||OBS;
  let nx=clamp(o.x+dx,0,MAP-o.w);
  if(!bl.some(b=>hits({x:nx,y:o.y,w:o.w,h:o.h},b))) o.x=nx;
  let ny=clamp(o.y+dy,0,MAP-o.h);
  if(!bl.some(b=>hits({x:o.x,y:ny,w:o.w,h:o.h},b))) o.y=ny;
}

// Enemy move clamped to zone bounds
function mvE(e,dx,dy){
  const z=ZN[e.zi], bl=OBS.concat(IW);
  let nx=clamp(e.x+dx,z.x,z.x+1000-e.w);
  if(!bl.some(b=>hits({x:nx,y:e.y,w:e.w,h:e.h},b))) e.x=nx;
  let ny=clamp(e.y+dy,z.y,z.y+1000-e.h);
  if(!bl.some(b=>hits({x:e.x,y:ny,w:e.w,h:e.h},b))) e.y=ny;
}

function abl(){
  if(P.cd>0) return;
  P.cd=10;
  if(di===0){
    // Emberclaw: fire blast in facing direction
    PJ.push({x:P.x+14,y:P.y+14,vx:fx*430,vy:fy*430,r:10,life:1.8});
  } else if(di===1){
    // Frostfang: ice wall perpendicular to movement, behind player
    const px=P.x-fx*58-10, py=P.y-fy*58-10;
    IW.push(Math.abs(fx)>Math.abs(fy)
      ?{x:px,   y:py-58, w:20, h:136,life:3}
      :{x:px-58,y:py,    w:136,h:20, life:3});
  } else if(di===2){ P.spT=3;
  } else if(di===3){ P.ivT=4;
  } else if(di===4){
    // Stormtalon: dash 230px in facing direction
    P.x=clamp(P.x+fx*230,0,MAP-28);
    P.y=clamp(P.y+fy*230,0,MAP-28);
  } else {
    // Shadowmend: freeze all enemies 5s
    ENS.forEach(e=>e.ft=5);
  }
}

function tick(ts){
  if(dead||won) return;
  const dt=Math.min((ts-(lts||ts))/1000,.05); lts=ts; gt+=dt;

  // Every 30s: scale all enemies +20%, spawn one new per zone
  if(Math.floor(gt/30)>st){
    st++;
    ENS.forEach(e=>{e.w*=1.2; e.h*=1.2; e.spd*=1.2;});
    ZN.forEach((_,zi)=>se(zi));
  }

  // Player input
  let dx=0, dy=0;
  if(keys.ArrowLeft ||keys.a||keys.A) dx--;
  if(keys.ArrowRight||keys.d||keys.D) dx++;
  if(keys.ArrowUp   ||keys.w||keys.W) dy--;
  if(keys.ArrowDown ||keys.s||keys.S) dy++;
  if(dx||dy){
    const m=hyp(0,0,dx,dy); fx=dx/m; fy=dy/m;
    mv(P, fx*180*(P.spT>0?2:1)*dt, fy*180*(P.spT>0?2:1)*dt);
  }
  if(P.cd>0)  P.cd-=dt;
  if(P.spT>0) P.spT-=dt;
  if(P.ivT>0) P.ivT-=dt;

  // Ice wall timers
  IW=IW.filter(w=>{w.life-=dt;return w.life>0;});

  // Fire projectiles ‚Äî destroy obstacles on hit
  PJ=PJ.filter(p=>{
    p.x+=p.vx*dt; p.y+=p.vy*dt; p.life-=dt;
    if(p.life<=0||p.x<0||p.x>MAP||p.y<0||p.y>MAP) return false;
    const i=OBS.findIndex(o=>hyp(p.x,p.y,o.x+o.w/2,o.y+o.h/2)<p.r+Math.max(o.w,o.h)/2);
    if(i>=0){
      const o=OBS[i];
      for(let j=0;j<8;j++) PTS.push({x:o.x+o.w/2,y:o.y+o.h/2,vx:rnd(-240,240),vy:rnd(-240,240),life:.7,c:'#ff6600'});
      OBS.splice(i,1); return false;
    }
    return true;
  });

  // Enemies
  ENS.forEach(e=>{
    if(e.ft>0){e.ft-=dt;return;}
    if(P.ivT>0) return; // invisible ‚Äî can't be targeted
    const px=P.x+14, py=P.y+14;
    const ang=Math.atan2(py-(e.y+e.h/2), px-(e.x+e.w/2));
    if(e.zi===0){
      // Magmawyrm: fast direct chaser
      mvE(e,Math.cos(ang)*e.spd*dt, Math.sin(ang)*e.spd*dt);
    } else if(e.zi===1){
      // Frostwyrm: slow but huge
      mvE(e,Math.cos(ang)*e.spd*dt, Math.sin(ang)*e.spd*dt);
    } else if(e.zi===2){
      // Tidewyrm: sinusoidal wave movement
      e.wt+=dt*2;
      const wa=ang+Math.sin(e.wt)*1.6;
      mvE(e,Math.cos(wa)*e.spd*dt, Math.sin(wa)*e.spd*dt);
    } else {
      // Thornwyrm: teleports short distances toward player
      e.tcd-=dt;
      if(e.tcd<=0){
        e.tcd=1.5+rnd(0,1.5);
        const td=80+rnd(0,90), z=ZN[3];
        e.x=clamp(e.x+Math.cos(ang)*td, z.x, z.x+1000-e.w);
        e.y=clamp(e.y+Math.sin(ang)*td, z.y, z.y+1000-e.h);
      }
    }
    if(hits(e,P)) endG(false);
  });

  // Zone eggs
  EGS.forEach(e=>{
    if(e.done) return;
    e.t+=dt*3;
    if(hits({x:e.x-e.r,y:e.y-e.r,w:e.r*2,h:e.r*2},P)){
      e.done=true;
      for(let j=0;j<12;j++) PTS.push({x:e.x,y:e.y,vx:rnd(-320,320),vy:rnd(-320,320),life:.9,c:'#ffff00'});
    }
  });

  // Spawn golden egg once all 4 zone eggs collected
  if(!GE && EGS.every(e=>e.done))
    GE={x:rnd(250,1750),y:rnd(250,1750),r:16,t:0};

  // Collect golden egg ‚Üí win
  if(GE){
    GE.t+=dt*4;
    if(hits({x:GE.x-GE.r,y:GE.y-GE.r,w:GE.r*2,h:GE.r*2},P)) endG(true);
  }

  // Particles
  PTS=PTS.filter(p=>{p.x+=p.vx*dt; p.y+=p.vy*dt; p.life-=dt; return p.life>0;});

  draw();
  requestAnimationFrame(tick);
}

function endG(w){
  won=w; dead=!w;
  document.getElementById('oT').textContent=w?'You Win! üèÜ':'Game Over üíÄ';
  document.getElementById('oM').textContent=w
    ?`All eggs collected in ${Math.floor(gt/60)}:${(gt%60|0).toString().padStart(2,'0')}!`
    :'A dragon enemy caught you!';
  document.getElementById('ov').style.display='flex';
}

function draw(){
  const W=cv.width, H=cv.height;
  // Camera: center on player, clamped to map
  const camx=clamp(P.x+14-W/2, 0, MAP-W);
  const camy=clamp(P.y+14-H/2, 0, MAP-H);
  ctx.clearRect(0,0,W,H);
  ctx.save(); ctx.translate(-camx,-camy);

  // Zone backgrounds
  ZN.forEach(z=>{
    ctx.fillStyle=z.bg; ctx.fillRect(z.x,z.y,1000,1000);
    ctx.strokeStyle=z.ac+'40'; ctx.lineWidth=4; ctx.strokeRect(z.x,z.y,1000,1000);
    ctx.fillStyle=z.ac+'50'; ctx.font='bold 14px Segoe UI';
    ctx.textAlign='left'; ctx.textBaseline='top'; ctx.fillText(z.n,z.x+14,z.y+14);
  });

  // Subtle grid
  ctx.strokeStyle='rgba(255,255,255,0.03)'; ctx.lineWidth=1;
  for(let i=0;i<=MAP;i+=200){
    ctx.beginPath();ctx.moveTo(i,0);ctx.lineTo(i,MAP);ctx.stroke();
    ctx.beginPath();ctx.moveTo(0,i);ctx.lineTo(MAP,i);ctx.stroke();
  }

  // Obstacles
  OBS.forEach(o=>{
    ctx.fillStyle=o.c; ctx.fillRect(o.x,o.y,o.w,o.h);
    ctx.strokeStyle='rgba(255,255,255,0.12)'; ctx.lineWidth=1; ctx.strokeRect(o.x,o.y,o.w,o.h);
  });

  // Ice walls
  IW.forEach(w=>{
    ctx.fillStyle='rgba(153,204,255,0.82)'; ctx.fillRect(w.x,w.y,w.w,w.h);
    ctx.strokeStyle='#cce8ff'; ctx.lineWidth=2; ctx.strokeRect(w.x,w.y,w.w,w.h);
  });

  // Zone eggs (glowing pulse)
  EGS.forEach(e=>{
    if(e.done) return;
    const glow=Math.sin(e.t)*5+e.r+4;
    ctx.beginPath(); ctx.arc(e.x,e.y,glow,0,6.28); ctx.fillStyle='rgba(255,255,0,0.12)'; ctx.fill();
    ctx.beginPath(); ctx.arc(e.x,e.y,e.r,0,6.28); ctx.fillStyle='#ffffcc'; ctx.fill();
    ctx.strokeStyle='#ffff00'; ctx.lineWidth=2; ctx.stroke();
    ctx.font='13px serif'; ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText('ü•ö',e.x,e.y);
  });

  // Golden egg
  if(GE){
    const glow=Math.sin(GE.t)*10+GE.r+6;
    ctx.beginPath(); ctx.arc(GE.x,GE.y,glow,0,6.28); ctx.fillStyle='rgba(255,215,0,0.25)'; ctx.fill();
    ctx.beginPath(); ctx.arc(GE.x,GE.y,GE.r,0,6.28);
    ctx.fillStyle='#ffd700'; ctx.fill(); ctx.strokeStyle='#fff'; ctx.lineWidth=3; ctx.stroke();
    ctx.font='22px serif'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText('ü•ö',GE.x,GE.y);
  }

  // Enemies
  ENS.forEach(e=>{
    ctx.save();
    if(e.ft>0) ctx.globalAlpha=.5;
    ctx.fillStyle=e.ft>0?'#aaddff':e.c;
    ctx.fillRect(e.x,e.y,e.w,e.h);
    ctx.font=`${clamp(e.w*.75,10,26)}px serif`;
    ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText('üê≤',e.x+e.w/2,e.y+e.h/2);
    ctx.restore();
  });

  // Fire projectiles
  PJ.forEach(p=>{
    ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,6.28); ctx.fillStyle='#ff6600'; ctx.fill();
    ctx.strokeStyle='rgba(255,170,0,0.5)'; ctx.lineWidth=5; ctx.stroke();
  });

  // Particles
  ctx.save();
  PTS.forEach(p=>{
    ctx.globalAlpha=Math.max(0,p.life);
    ctx.beginPath(); ctx.arc(p.x,p.y,3,0,6.28); ctx.fillStyle=p.c; ctx.fill();
  });
  ctx.restore();

  // Player
  ctx.save();
  if(P.ivT>0) ctx.globalAlpha=.3;
  ctx.font='30px serif'; ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.fillText(DR[di].em, P.x+14, P.y+14);
  ctx.restore();

  ctx.restore(); // end camera transform

  // HUD
  const col=EGS.filter(e=>e.done).length;
  const mins=Math.floor(gt/60), secs=(gt%60|0).toString().padStart(2,'0');
  document.getElementById('hud').innerHTML=
    `‚è± ${mins}:${secs} &nbsp;|&nbsp; ü•ö ${col}/4`+
    (GE?'<br><b style="color:#ffd700">‚ú® Find the Golden Egg!</b>':'')+
    (P.ivT>0?`<br><span style="color:#88ff88">üëÅ Invisible ${P.ivT.toFixed(1)}s</span>`:'')+
    (P.spT>0?`<br><span style="color:#88ccff">‚ö° Speed ${P.spT.toFixed(1)}s</span>`:'');

  const cd=document.getElementById('cdbar');
  cd.style.color=P.cd>0?'#888':'#ffd700';
  cd.textContent=P.cd>0?`[SPACE] Recharging ${P.cd.toFixed(1)}s‚Ä¶`:`[SPACE] ${DR[di].ab}`;
}

document.addEventListener('keydown',e=>{
  keys[e.key]=true;
  if(e.key===' '){e.preventDefault(); if(P&&!dead&&!won) abl();}
  if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key)) e.preventDefault();
});
document.addEventListener('keyup',e=>{keys[e.key]=false;});
window.addEventListener('resize',()=>{
  if(document.getElementById('game').style.display!=='none'){
    cv.width=innerWidth; cv.height=innerHeight;
  }
});
</script>
</body>
</html>
